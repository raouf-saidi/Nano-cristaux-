<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Service Biocimentation</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
<link href="./css/style.css?v=1" rel="stylesheet">

</head>
<body class="d-flex flex-column min-vh-100">

<!-- NAVBAR -->
<nav class="navbar navbar-expand-lg navbar-dark bg-dark fixed-top">
  <div class="container">
    <a class="navbar-brand fw-bold" href="index.html">Biocimentation</a>
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse"
            data-bs-target="#navbarNav">
      <span class="navbar-toggler-icon"></span>
    </button>
    <div class="collapse navbar-collapse" id="navbarNav">
      <ul class="navbar-nav ms-auto">
        <li class="nav-item"><a class="nav-link" href="index.html">Présentation</a></li>
        <li class="nav-item"><a class="nav-link" href="service.html">Service</a></li>
        <li class="nav-item"><a class="nav-link active" href="llm.html">IA</a></li>
      </ul>
    </div>
  </div>
</nav>

<div style="height:70px"></div>

<!-- PAGE IA -->
<div class="container my-5">
  <div class="row g-4">

    <!-- CARTE CONTEXTE / AIDE -->
    <div class="col-md-4">
      <div class="card h-100 shadow llm-card">
        <div class="card-body">
          <h5 class="card-title">Assistant IA</h5>
          <p class="text-muted mb-3">
            Pose des questions sur la biocimentation, la lecture d’images SEM/MEB,
            ou demande une interprétation des résultats.
          </p>

          <div class="llm-hint">
           <!-- PREVIEW IMAGE (remplace les exemples si image choisie) -->
<div id="leftPreviewWrap" class="llm-hint d-none">
  <div class="fw-semibold mb-2">Image envoyée</div>
  <img id="leftPreviewImg" class="img-fluid rounded" alt="Aperçu image SEM">
  <small id="leftPreviewName" class="text-muted d-block mt-2"></small>
  <button id="leftPreviewClear" class="btn btn-outline-secondary btn-sm mt-2 w-100" type="button">
    Retirer l’image
  </button>
</div>

<!-- EXEMPLES (visible quand pas d'image) -->
<div id="leftExamplesWrap" class="llm-hint">
  <div class="fw-semibold mb-2">Exemples de questions</div>
  <ul class="mb-0">
    <li>Est-ce que le pontage semble fort ou faible ?</li>
    <li>Quels artefacts SEM peuvent fausser l’analyse ?</li>
    <li>Quels réglages (contraste / zoom) recommandes-tu ?</li>
    <li>Comment interpréter une couverture élevée de CaCO₃ ?</li>
  </ul>
</div>
</div>

          <hr class="my-4">

          <div class="d-flex gap-2">
            <button id="chatClearBtn" class="btn btn-outline-secondary btn-sm w-100">
              Effacer l’historique
            </button>
          </div>

          <small class="text-muted d-block mt-2">
            L’historique est sauvegardé dans ton navigateur (local).
          </small>
        </div>
      </div>
    </div>

    <!-- CARTE CHAT -->
    <div class="col-md-8">
      <div class="card h-100 shadow llm-card">
        <div class="card-body d-flex flex-column">

          <div class="d-flex align-items-center justify-content-between mb-2">
            <h5 class="card-title mb-0">Chat</h5>
            <span class="llm-badge">Vision SEM • Biocimentation</span>
          </div>

          <!-- ZONE MESSAGES -->
          <div id="chatMessages" class="chat-box flex-grow-1"></div>

          <!-- TYPING -->
          <div id="chatTyping" class="small text-muted mt-2 d-none">L’IA écrit…</div>

          <!-- INPUTS -->
          <div class="mt-3">
            <label class="form-label mb-1">Message</label>
            <textarea id="chatInput" class="form-control chat-input" rows="1"
  placeholder="Écris ta question (Shift+Enter pour aller à la ligne)"></textarea>

            <div class="d-flex align-items-center justify-content-between gap-2 mt-2 flex-wrap">
              <div class="d-flex align-items-center gap-2 flex-wrap">
                <input id="chatImageInput" type="file" class="form-control form-control-sm"
                       accept="image/*" style="max-width: 280px;">
                <small class="text-muted">Optionnel : joindre une image SEM</small>
              </div>

              <div class="d-flex gap-2">
                <button id="chatSendBtn" class="btn btn-success" onclick="sendChatMessage()">
                  Envoyer
                </button>
              </div>
            </div>

          </div>

          <small class="text-muted mt-2">
            Conseil : pour une analyse plus fiable, envoie l’image + contexte (zoom, conditions, objectif).
          </small>

        </div>
      </div>
    </div>

  </div>
</div>

<footer class="text-center mt-auto py-3 bg-dark text-white">
  © 2026 – Projet Biocimentation – Laboratoire PFE
</footer>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>


<!-- MODAL FEEDBACK (correction) -->
<div class="modal fade" id="feedbackModal" tabindex="-1" aria-hidden="true">
  <div class="modal-dialog modal-lg modal-dialog-centered">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title">Correction / Feedback</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Fermer"></button>
      </div>
      <div class="modal-body">
        <div class="mb-2">
          <div class="fw-semibold">Question (utilisateur)</div>
          <div id="fbQuestion" class="small text-muted"></div>
        </div>

        <div class="mb-3">
          <div class="fw-semibold">Réponse IA (originale)</div>
          <div id="fbAnswer" class="small" style="white-space:pre-wrap;"></div>
        </div>

        <div class="mb-3">
          <label class="form-label fw-semibold">Ta correction / réponse attendue</label>
          <textarea id="fbCorrection" class="form-control" rows="4"
            placeholder="Explique ce qui est faux / incomplet et donne la réponse correcte si possible."></textarea>
        </div>

        <div class="mb-3">
          <label class="form-label fw-semibold">Tags (optionnel)</label>
          <input id="fbTags" class="form-control" placeholder="ex: zoom, pontage, morphologie, artefacts">
          <div class="form-text">Sépare par des virgules.</div>
        </div>

        <div class="mb-3">
          <label class="form-label fw-semibold">Note</label>
          <select id="fbRating" class="form-select" style="max-width:160px;">
            <option value="1">1 (mauvais)</option>
            <option value="2">2</option>
            <option value="3" selected>3</option>
            <option value="4">4</option>
            <option value="5">5 (excellent)</option>
          </select>
        </div>

      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-outline-secondary" data-bs-dismiss="modal">Annuler</button>
        <button type="button" class="btn btn-primary" id="fbSaveBtn">Enregistrer</button>
      </div>
    </div>
  </div>
</div>
<!-- JS CHAT -->
<script src="js/chatbot.js"></script>
<script>
  document.addEventListener("DOMContentLoaded", initChatbot);
</script>
</body>
</html>
